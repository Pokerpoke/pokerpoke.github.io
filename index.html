<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://pokerpoke.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://pokerpoke.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-1.nginx将.js .css处理为text plain" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/08/1.nginx将.js .css处理为text plain/" class="article-date">
  <time datetime="2018-03-09T06:38:50.598Z" itemprop="datePublished">2018-03-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="nginx将-js-css处理为text-plain"><a href="#nginx将-js-css处理为text-plain" class="headerlink" title="nginx将.js .css处理为text/plain"></a>nginx将.js .css处理为text/plain</h1><h2 id="1-问题"><a href="#1-问题" class="headerlink" title="1.问题"></a>1.问题</h2><p>在使用Django+uwsgi+nginx部署过程中会遇到如下问题，使用Django处理静态文件，运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver</span><br></pre></td></tr></table></figure>
<p>可以加载.js、.css文件。部署时将<code>DEBUG = True</code>改为<code>DEBUG = False</code>以后Django不再处理静态文件此时需要以下命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py collectstatic</span><br></pre></td></tr></table></figure>
<p>在<code>settings.py</code>中设置<code>STATIC_ROOT</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STATIC_ROOT = os.path.join(BASE_DIR, <span class="string">'collected_static'</span>)</span><br></pre></td></tr></table></figure>
<p>将所有的静态文件收集到<code>collected_static</code>文件夹下<br>在nginx配置中添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location /static &#123;</span><br><span class="line">    # alias /path/to/your/mysite/static; # your Django project&apos;s static files - amend as required</span><br><span class="line">    alias /mysite/collected_static;</span><br><span class="line">    expires 1d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ps:alias与root的区别：</p>
<p>alias对应路径<code>/mysite/collected_static</code></p>
<p>root对应路径<code>/mysite/colletcted_static/static</code></p>
<p>此时通过浏览器可以发现可以加载网页，但是样式全没了，只有文字</p>
<p>通过chrome的调试功能可以发现，浏览器将.css与.js文件处理为text/plain了</p>
<h2 id="2-解决方案"><a href="#2-解决方案" class="headerlink" title="2.解决方案"></a>2.解决方案</h2><p>在nginx的配置文件中添加以下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">include /etc/nginx/mine.types</span><br><span class="line"></span><br><span class="line">location ~ \.js &#123;</span><br><span class="line">    add_header  Content-Type    application/x-javascript;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~ \.css &#123;</span><br><span class="line">    add_header  Content-Type    text/css;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时<strong>清空浏览器缓存</strong>，建议在chrome调试的时候勾选<code>Disable cache</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pokerpoke.github.io/2018/03/08/1.nginx将.js .css处理为text plain/" data-id="cjejklnn7000fv2jxckp59k0n" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-15.samba配置文件共享服务" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/08/15.samba配置文件共享服务/" class="article-date">
  <time datetime="2018-03-09T06:38:50.598Z" itemprop="datePublished">2018-03-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="samba配置文件共享服务"><a href="#samba配置文件共享服务" class="headerlink" title="samba配置文件共享服务"></a>samba配置文件共享服务</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Samba是在Linux和UNIX系统上实现SMB协议的一个免费软件，由服务器及客户端程序构成。SMB（Server Messages Block，信息服务块）是一种在局域网上共享文件和打印机的一种通信协议，它为局域网内的不同计算机之间提供文件及打印机等资源的共享服务。SMB协议是客户机/服务器型协议，客户机通过该协议可以访问服务器上的共享文件系统、打印机及其他资源。通过设置“NetBIOS over TCP/IP”使得Samba不但能与局域网络主机分享资源，还能与全世界的电脑分享资源。—<a href="https://baike.baidu.com/item/Samba" target="_blank" rel="noopener">百度百科</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install samba</span><br></pre></td></tr></table></figure>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>修改<code>/etc/samba/smb.conf</code>文件，在末尾添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[share]</span><br><span class="line">comment = Share directories</span><br><span class="line">path = /path/to/share/directories</span><br><span class="line">browseable = yes</span><br><span class="line">writable = yes</span><br><span class="line">guest ok = yes</span><br><span class="line">create mask = 0777</span><br></pre></td></tr></table></figure>
<p>如果需要开启windows支持，以便windows也能访问，则修改以下行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wins support = yes</span><br></pre></td></tr></table></figure>
<h2 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/samba restart</span><br></pre></td></tr></table></figure>
<h2 id="参考网页"><a href="#参考网页" class="headerlink" title="参考网页"></a>参考网页</h2><ol>
<li><a href="http://cn.linux.vbird.org/linux_server/0370samba.php" target="_blank" rel="noopener">第十六章、文件服务器之二:SAMBA 服务器—鸟哥的Linux私房菜</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Samba_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87" target="_blank" rel="noopener">Samba—archlinux wiki</a>)</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pokerpoke.github.io/2018/03/08/15.samba配置文件共享服务/" data-id="cjejkg24i0005uajx6gjyu81o" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-16.deluge+ss实现服务器ipv6环境下bt下载" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/08/16.deluge+ss实现服务器ipv6环境下bt下载/" class="article-date">
  <time datetime="2018-03-09T06:38:50.598Z" itemprop="datePublished">2018-03-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="deluge-ss实现服务器ipv6环境下bt下载"><a href="#deluge-ss实现服务器ipv6环境下bt下载" class="headerlink" title="deluge+ss实现服务器ipv6环境下bt下载"></a>deluge+ss实现服务器ipv6环境下bt下载</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>教育网ipv6的pt下载是个好东西，但是离开学校以后就没有ipv6环境了，现在可以通过vps挂载ss的方式进行pt下载。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>一个支持ipv6并且已经挂载了ss的VPS，网上有大量教程，不再赘述。</p>
<h2 id="相关软件"><a href="#相关软件" class="headerlink" title="相关软件"></a>相关软件</h2><ol>
<li><p><a href="http://deluge-torrent.org/" target="_blank" rel="noopener">deluge</a></p>
<p> Deluge是一个功能齐全的跨平台BitTorrent 客户端软件，可在Linux, OS X, Unix和Windows操作系统下工作。它使用libtorrent作为其后端，有包括GTK+，网络远程客户端，命令行模式等多种用户界面。其设计方针是体积小巧且节约系统资源，通过丰富的插件来实现核心以外的众多功能。Deluge响应Freedesktop.org的倡议，兼容于GNOME, KDE, XFCE和其它多种桌面环境。它还是一款自由软件，使用GPLv3进行授权。</p>
<p> 因为deluge有一个相对友好的web界面很适合进行远程操作。</p>
</li>
<li><p><a href="http://supervisord.org/" target="_blank" rel="noopener">supervisor</a></p>
<p> 教程参见我都另一篇文章—<a href="https://www.jianshu.com/p/744f7f235a92" target="_blank" rel="noopener">使用 supervisor 管理进程</a></p>
</li>
</ol>
<h2 id="安装deluge"><a href="#安装deluge" class="headerlink" title="安装deluge"></a>安装deluge</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install deluged deluge-web</span><br></pre></td></tr></table></figure>
<h2 id="启动deluge-web"><a href="#启动deluge-web" class="headerlink" title="启动deluge-web"></a>启动deluge-web</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deluge-web</span><br></pre></td></tr></table></figure>
<p>此时已经可以通过访问<code>http://127.0.0.1:8112</code>访问deluge的web页面。</p>
<h2 id="守护进程"><a href="#守护进程" class="headerlink" title="守护进程"></a>守护进程</h2><p><strong>注意</strong> 此操作需要安装supervisor，参见<a href="https://www.jianshu.com/p/744f7f235a92" target="_blank" rel="noopener">使用 supervisor 管理进程</a>。</p>
<p>配置文件修改如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[program:deluge-web]</span><br><span class="line">directory = /path/to/pt ; 程序的启动目录</span><br><span class="line">command = deluge-web    ; 运行的指令</span><br><span class="line">autostart = true     ; 在 supervisord 启动的时候也自动启动</span><br><span class="line">startsecs = 5        ; 启动 5 秒后没有异常退出，就当作已经正常启动了</span><br><span class="line">autorestart = true   ; 程序异常退出后自动重启</span><br><span class="line">startretries = 3     ; 启动失败自动重试次数，默认是 3</span><br><span class="line">user = your_user_name          ; 用哪个用户启动</span><br><span class="line">redirect_stderr = true  ; 把 stderr 重定向到 stdout，默认 false</span><br><span class="line">stdout_logfile_maxbytes = 20MB  ; stdout 日志文件大小，默认 50MB</span><br><span class="line">stdout_logfile_backups = 20     ; stdout 日志文件备份数</span><br></pre></td></tr></table></figure>
<p>启动守护进程</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo supervisorctl</span><br><span class="line"></span><br><span class="line"><span class="meta">supervisor&gt;</span> reload</span><br><span class="line"><span class="meta">supervisor&gt;</span> start deluge-web</span><br></pre></td></tr></table></figure>
<h2 id="配置ss"><a href="#配置ss" class="headerlink" title="配置ss"></a>配置ss</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python-pip python-setuptools m2crypto</span><br><span class="line">sudo pip install shadowsocks</span><br></pre></td></tr></table></figure>
<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/</span><br><span class="line">sudo mkdir shadowsocks</span><br><span class="line">sudo touch config.json</span><br><span class="line">sudo vim config.json</span><br></pre></td></tr></table></figure>
<p>修改为以下内容</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"server"</span>:<span class="string">"11.22.33.44"</span>,</span><br><span class="line">    <span class="attr">"server_port"</span>:<span class="number">8183</span>,</span><br><span class="line">    <span class="attr">"local_port"</span>:<span class="number">1080</span>,</span><br><span class="line">    <span class="attr">"password"</span>:<span class="string">"123456"</span>,</span><br><span class="line">    <span class="attr">"timeout"</span>:<span class="number">600</span>,</span><br><span class="line">    <span class="attr">"method"</span>:<span class="string">"aes-256-cfb"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动ss</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sslocal -c /etc/shadowsocks/config.json -d start</span><br></pre></td></tr></table></figure>
<h2 id="启用deluge"><a href="#启用deluge" class="headerlink" title="启用deluge"></a>启用deluge</h2><p>需要先连接一个本地的deluge进程，点击connect即可</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6219057-981ce697b4751056.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="连接进程"></p>
<h2 id="在deluge中启用代理"><a href="#在deluge中启用代理" class="headerlink" title="在deluge中启用代理"></a>在deluge中启用代理</h2><p><img src="http://upload-images.jianshu.io/upload_images/6219057-30e174fb8759c80a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="代理设置"></p>
<p>然后就可以愉快的使用ipv6进行下载上传了~Enjoy~</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pokerpoke.github.io/2018/03/08/16.deluge+ss实现服务器ipv6环境下bt下载/" data-id="cjejkg24j0006uajxyj7a5dk8" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-14.树莓派连接无线网络" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/08/14.树莓派连接无线网络/" class="article-date">
  <time datetime="2018-03-09T06:38:50.594Z" itemprop="datePublished">2018-03-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="树莓派连接无线网络"><a href="#树莓派连接无线网络" class="headerlink" title="树莓派连接无线网络"></a>树莓派连接无线网络</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>树莓派使用<a href="https://wiki.archlinux.org/index.php/WPA_supplicant" target="_blank" rel="noopener">wpa_supplicant</a>来进行无线网络的认证。</p>
<h2 id="刚烧录竟像时"><a href="#刚烧录竟像时" class="headerlink" title="刚烧录竟像时"></a>刚烧录竟像时</h2><ul>
<li>在windows系统中</li>
</ul>
<p>使用<a href="http://www.ext2fsd.com/" target="_blank" rel="noopener">ext2fsd</a>或者<a href="http://www.diskgenius.cn/" target="_blank" rel="noopener">Diskgenius</a>打开Linux下的文件。</p>
<ul>
<li>在Linux系统中直接打开SD卡所在目录</li>
</ul>
<p>在<code>/etc/wpa_supplicant/wpa_supplicant.conf</code>中添加以下命令(如果在Linux下需要root权限进行修改)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">network=&#123;</span><br><span class="line">    ssid=&quot;your wifi name&quot;</span><br><span class="line">    psk=&quot;your wifi password&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之后将SD卡插入树莓派通电即可。</p>
<h2 id="在烧录完成的系统中"><a href="#在烧录完成的系统中" class="headerlink" title="在烧录完成的系统中"></a>在烧录完成的系统中</h2><p>需要通过有线的方式先接入网络或者USB的方式创建局域网，以便远程登陆。推荐使用<a href="#2.刚烧录竟像时">2</a>中的方法直接修改SD卡数据。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/wpa_supplicant/wpa_supplicant.conf</span><br></pre></td></tr></table></figure>
<p>添加以下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">network=&#123;</span><br><span class="line">    ssid=&quot;your wifi name&quot;</span><br><span class="line">    psk=&quot;your wifi password&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重启网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/networking restart</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://pokerpoke.github.io/2018/03/08/14.树莓派连接无线网络/" data-id="cjejkg24h0004uajx8gmfiwf2" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-13.树莓派烧录系统镜像" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/08/13.树莓派烧录系统镜像/" class="article-date">
  <time datetime="2018-03-09T06:38:50.590Z" itemprop="datePublished">2018-03-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="树莓派烧录系统镜像"><a href="#树莓派烧录系统镜像" class="headerlink" title="树莓派烧录系统镜像"></a>树莓派烧录系统镜像</h1><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul>
<li><a href="https://www.raspberrypi.org/downloads/" target="_blank" rel="noopener">树莓派镜像</a></li>
<li><a href="https://sourceforge.net/projects/win32diskimager/" target="_blank" rel="noopener">win32diskimager</a></li>
</ul>
<h2 id="在windows下烧录"><a href="#在windows下烧录" class="headerlink" title="在windows下烧录"></a>在windows下烧录</h2><p><img src="http://upload-images.jianshu.io/upload_images/6219057-b79c94137a81dead.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="烧录镜像"></p>
<p>打开软件，点击写入即可。</p>
<h2 id="在Linux下烧录"><a href="#在Linux下烧录" class="headerlink" title="在Linux下烧录"></a>在Linux下烧录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo dd if=/path/to/your/iso/file of=/path/to/your/device</span><br><span class="line"><span class="meta">#</span> /path/to/your/device可能是/dev/sdb等等</span><br></pre></td></tr></table></figure>
<p>该过程可能耗时比较长。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pokerpoke.github.io/2018/03/08/13.树莓派烧录系统镜像/" data-id="cjejkg24g0003uajxm5wr2608" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-12.搭建私人GitLab" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/08/12.搭建私人GitLab/" class="article-date">
  <time datetime="2018-03-09T06:38:50.578Z" itemprop="datePublished">2018-03-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="搭建私人GitLab"><a href="#搭建私人GitLab" class="headerlink" title="搭建私人GitLab"></a>搭建私人GitLab</h1><h2 id="GitLab简介"><a href="#GitLab简介" class="headerlink" title="GitLab简介"></a>GitLab简介</h2><p><a href="https://zh.wikipedia.org/wiki/Gitlab" target="_blank" rel="noopener">GitLab</a>是一个利用Ruby on Rails开发的开源应用程序，实现一个自托管的Git项目仓库，可通过Web界面进行访问公开的或者私人项目。</p>
<p>它拥有与GitHub类似的功能，能够浏览源代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提交过的版本并提供一个文件历史库。团队成员可以利用内置的简单聊天程序（Wall）进行交流。它还提供一个代码片段收集功能可以轻松实现代码复用，便于日后有需要的时候进行查找。</p>
<p>GitLab要求服务器端采用Gitolite搭建（为了方便安装，现已经用gitlab-shell代替Gitolite）。</p>
<p><a href="https://about.gitlab.com/installation/" target="_blank" rel="noopener">官方安装教程</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install -y curl openssh-server ca-certificates</span><br></pre></td></tr></table></figure>
<p>如果使用SMTP服务还需要安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install -y postfix</span><br></pre></td></tr></table></figure>
<p>添加源</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.deb.sh | sudo bash</span><br></pre></td></tr></table></figure>
<p>安装gitlab-ee，其中<code>EXTERNAL_URL</code>为需要监听的地址，本地使用可以监听<code>http://127.0.0.1</code>，该设置可以在后面修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo EXTERNAL_URL="http://gitlab.example.com" apt-get install gitlab-ee</span><br></pre></td></tr></table></figure>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>至此，GitLab已经安装完了，启动就行了，<a href="https://docs.gitlab.com/omnibus/settings/configuration.html#configuring-the-external-url-for-gitlab" target="_blank" rel="noopener">GitLab官方配置教程</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://pokerpoke.github.io/2018/03/08/12.搭建私人GitLab/" data-id="cjejkg24e0002uajxu7isq04s" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-11.Nginx搭建简单的文件共享服务" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/08/11.Nginx搭建简单的文件共享服务/" class="article-date">
  <time datetime="2018-03-09T06:38:50.574Z" itemprop="datePublished">2018-03-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Nginx搭建简单的文件共享服务"><a href="#Nginx搭建简单的文件共享服务" class="headerlink" title="Nginx搭建简单的文件共享服务"></a>Nginx搭建简单的文件共享服务</h1><h2 id="0-简介"><a href="#0-简介" class="headerlink" title="0.简介"></a>0.简介</h2><p>Nginx（发音同engine x）是一个 Web服务器，也可以用作反向代理，负载平衡器和 HTTP缓存。该软件由 Igor Sysoev 创建，并于2004年首次公开发布。同名公司成立于2011年，以提供支持。Nginx是一款免费的开源软件，根据类BSD许可证的条款发布。大部分 Web服务器通常使用 NGINX 作为负载均衡器。</p>
<p>在树莓派上搭建了git服务器和samba服务器，但是有一些比较大的二进制文件通过git下载比较缓慢，同时wget和curl无法支持samba协议，所以产生了使用nginx搭建一个简单的文件共享服务器，使用wget进行拉取的想法，以方便使用脚本的方式进行项目的编译构建。<br>PS:git有一个LFS的插件(?)可以管理大文件，尚未深入研究。</p>
<h2 id="1-安装Nginx"><a href="#1-安装Nginx" class="headerlink" title="1.安装Nginx"></a>1.安装Nginx</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure>
<h2 id="2-配置Nginx"><a href="#2-配置Nginx" class="headerlink" title="2.配置Nginx"></a>2.配置Nginx</h2><p>默认配置文件位于<code>/etc/nginx/sites-available/default</code>下，NGinx的站点配置方法是在<code>sites-available</code>文件夹下建立相关配置文件，然后软链接到<code>sites-enable</code>文件夹下，所以，先在<code>sites-available</code>文件夹下复制<code>default</code>文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp default fileserver</span><br></pre></td></tr></table></figure>
<p>修改下列内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen  80;</span><br><span class="line">    # 自己PC的ip或者服务器的域名</span><br><span class="line">    server_name 10.1.2.3;</span><br><span class="line">    # 避免中文乱码</span><br><span class="line">    charset utf-8;</span><br><span class="line">    # 存放文件的目录</span><br><span class="line">    root /home/pi/share;</span><br><span class="line">    location / &#123;</span><br><span class="line">        # 索引</span><br><span class="line">        autoindex on;</span><br><span class="line">        # 显示文件大小</span><br><span class="line">        autoindex_exact_size on;</span><br><span class="line">        # 显示文件时间</span><br><span class="line">        autoindex_localtime on;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启用配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/nginx/sites-enable</span><br><span class="line">sudo ln -s ../sites-available/fileserver ./</span><br></pre></td></tr></table></figure>
<h2 id="3-重启Nginx"><a href="#3-重启Nginx" class="headerlink" title="3.重启Nginx"></a>3.重启Nginx</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginx restart</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/nginx restart</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://pokerpoke.github.io/2018/03/08/11.Nginx搭建简单的文件共享服务/" data-id="cjejkg24c0001uajx8bqvxia1" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-10.Linux编译、分发工具演化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/08/10.Linux编译、分发工具演化/" class="article-date">
  <time datetime="2018-03-09T06:38:50.561Z" itemprop="datePublished">2018-03-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Linux编译、分发工具演化"><a href="#Linux编译、分发工具演化" class="headerlink" title="Linux编译、分发工具演化"></a>Linux编译、分发工具演化</h1><h2 id="1-gcc-g"><a href="#1-gcc-g" class="headerlink" title="1.gcc/g++"></a>1.gcc/g++</h2><p>GNU编译器套装（英语：GNU Compiler Collection，缩写为GCC），一套编程语言编译器，以GPL及LGPL许可证所发行的自由软件，也是GNU项目的关键部分，也是GNU工具链的主要组成部分之一。GCC（特别是其中的C语言编译器）也常被认为是跨平台编译器的事实标准。1985年由理查德·马修·斯托曼开始发展，现在由自由软件基金会负责维护工作。</p>
<p>原名为GNU C语言编译器（GNU C Compiler），因为它原本只能处理C语言。GCC很快地扩展，变得可处理C++。之后也变得可处理Fortran、Pascal、Objective-C、Java、Ada，以及Go与其他语言。</p>
<p>许多操作系统，包括许多类Unix系统，如Linux及BSD家族都采用GCC作为标准编译器。苹果电脑预装的Mac OS X操作系统也采用这个编译器。</p>
<p>GCC原本用C开发，后来因为LLVM、Clang的崛起，它更快地将开发语言转换为C++。许多C的爱好者在对C++一知半解的情况下主观认定C++的性能一定会输给C，但是Taylor给出了不同的意见，并表明C++不但性能不输给C，而且能设计出更好，更容易维护的程序[（GCC’s move to C++）。<a href="https://zh.wikipedia.org/wiki/GCC" target="_blank" rel="noopener">gcc–wiki</a></p>
<p>gcc应该是Linux系统中最基础的编译方式了，后来演化出的makefile、cmake等等最后也转化成了相应的gcc命令来执行，对于<code>test.cc</code>，gcc的一步到位的命令如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc test.c -o test</span><br></pre></td></tr></table></figure>
<p>实际上，这个过程经过了预编译，编译，汇编，链接四个步骤，具体解释可以参见<a href="http://www.cnblogs.com/ggjucheng/archive/2011/12/14/2287738.html" target="_blank" rel="noopener">Linux GCC常用命令</a>，但是每次编译都需要输入命令行太麻烦了，于是可以使用make命令。</p>
<h2 id="2-make"><a href="#2-make" class="headerlink" title="2.make"></a>2.make</h2><p>在软件开发中，make是一个工具程序（Utility software），经由读取叫做“makefile”的文件，自动化建构软件。它是一种转化文件形式的工具，转换的目标称为“target”；与此同时，它也检查文件的依赖关系，如果需要的话，它会调用一些外部软件来完成任务。它的依赖关系检查系统非常简单，主要根据依赖文件的修改时间进行判断。大多数情况下，它被用来编译源代码，生成结果代码，然后把结果代码连接起来生成可执行文件或者库文件。它使用叫做“makefile”的文件来确定一个target文件的依赖关系，然后把生成这个target的相关命令传给shell去执行。<a href="https://zh.wikipedia.org/zh-cn/Make" target="_blank" rel="noopener">make–wiki</a></p>
<p>make命令的一般使用方式是先读取相关系统配置，之后使用make进行编译，等待编译完成以后将相关库文件或者可执行文件安装到系统路径。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>一个makefile的教程，<a href="http://wiki.ubuntu.org.cn/%E8%B7%9F%E6%88%91%E4%B8%80%E8%B5%B7%E5%86%99Makefile" target="_blank" rel="noopener">跟我一起写Makefile</a>。使用makefile也会产生一个问题，会在源代码所在目录产生许多中间文件，虽然可以使用<code>make clean</code>进行删除，但还是很麻烦，而且makefile的抽象程度并不高，所以产生了，cmake、autotools等高度抽象工具，cmake还能在不污染源代码目录的情况下进行编译，所以很多开源项目开始采用cmake的方式进行编译。</p>
<h2 id="3-cmake-qmake"><a href="#3-cmake-qmake" class="headerlink" title="3.cmake/qmake"></a>3.cmake/qmake</h2><p>CMake前面已经介绍过了，不再赘述。</p>
<p>qmake是编译Qt项目时用的，但是不如CMake好用。</p>
<p>其实cmake等工具也是生成makefile的方式进行编译项目，在执行<code>cmake ..</code>命令以后可以在<code>build</code>目录下发现makefile文件。</p>
<h2 id="4-二进制分发"><a href="#4-二进制分发" class="headerlink" title="4.二进制分发"></a>4.二进制分发</h2><p>顾名思义，就是直接将编译好的可执行程序或者动态库拷贝到生产环境中，这种情况下的部署速度应该只有网速或者U盘读取速度有关了，缺点也很明显，需要保证开发环境与生产环境的基本一致，需要保证依赖库在生产环境中存在。</p>
<h2 id="5-git"><a href="#5-git" class="headerlink" title="5.git"></a>5.git</h2><p>git是一个分布式的版本管理工具，也是目前最流行的版本管理工具，同时<a href="https://github.com/" target="_blank" rel="noopener">github</a>也成为了目前最流行的项目托管平台，同时gitlab、gitea等开源工具也能用来搭建私人的项目托管服务器，所以git也可以算是一个很方便的分发、部署工具，对于一般项目，只需要短短几行代码就能从源码进行构建。</p>
<p>面对一个全新的环境，我们完全可以用这种方法进行软件分发，项目部署，但是缺点也很明显，每次都需要从源码进行构建，在项目较大或者计算机性能不足够的时候费时费力。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone http://path/to/test.git</span><br><span class="line">cd test</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake .. &amp;&amp; make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure>
<h2 id="6-包管理"><a href="#6-包管理" class="headerlink" title="6.包管理"></a>6.包管理</h2><p>软件包管理系统是在电脑中自动安装、配制、卸载和升级软件包的工具组合，在各种系统软件和应用软件的安装管理中均有广泛应用。</p>
<p>在Linux发行版中，几乎每一个发行版都有自己的软件包管理系统。常见的有：</p>
<ul>
<li>管理deb软件包的dpkg以及它的前端apt（使用于Debian、Ubuntu）。</li>
<li>RPM套件管理員以及它的前端dnf（使用于Fedora）、前端yum（使用于Red Hat Enterprise Linux）、前端ZYpp（使用于openSUSE）、前端urpmi（使用于Mandriva Linux、Mageia）等。使用软件包管理系统将大大简化在Linux发行版中安装软件的过程。<a href="https://zh.wikipedia.org/wiki/%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F" target="_blank" rel="noopener">软件包管理系统—wiki</a></li>
</ul>
<p>使用cpack进行打包，会在deb包中添加相关的依信息，参考<a href="https://nowardev.wordpress.com/2009/12/27/how-to-create-a-debian-package-for-script-and-for-project-that-use-cmake/" target="_blank" rel="noopener">这篇文章</a>。优点很明显，解决了二进制分发的依赖的问题，只要在包信息中添加相关信息，会在部署时自动安装相关依赖，也解决了源码分发的速度问题，缺点也很明显，如果目标系统中没有包管理系统，就GG了。所以产生了另一种分发机制，镜像分发，其中比较流行的是docker。</p>
<h2 id="7-docker"><a href="#7-docker" class="headerlink" title="7.docker"></a>7.docker</h2><p>详细介绍参见<a href="https://yeasy.gitbooks.io/docker_practice/content/introduction/what.html" target="_blank" rel="noopener">docker–gitbook</a>。</p>
<p>docker的实质是一种虚拟化技术，传统的虚拟化技术是在宿主机虚拟出一套完整的硬件后运行一个完整的操作系统，并在该虚拟系统中运行所需应用，而docker直接运行与宿主内核，相比传统虚拟机更为轻便。</p>
<p>如果通过docker进行分发，只需要在相应的docker镜像中编译相应的程序以及依赖库，然后将镜像推送到服务器上，在开发环境中进行下载即可，这种方式对需要大规模部署的项目来说，效率很高，而且更加易于维护和扩展。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pokerpoke.github.io/2018/03/08/10.Linux编译、分发工具演化/" data-id="cjejkg2480000uajxclotuuaj" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-9.JRTPLIB使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/08/9.JRTPLIB使用/" class="article-date">
  <time datetime="2018-03-09T06:38:41.272Z" itemprop="datePublished">2018-03-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="JRTPLIB使用"><a href="#JRTPLIB使用" class="headerlink" title="JRTPLIB使用"></a>JRTPLIB使用</h1><h2 id="1-RTP简介"><a href="#1-RTP简介" class="headerlink" title="1.RTP简介"></a>1.RTP简介</h2><p>实时传输协议（Real-time Transport Protocol或简写RTP）是一个网络传输协议，它是由IETF的多媒体传输工作小组1996年在RFC 1889中公布的。</p>
<p>国际电信联盟ITU-T也发布了自己的RTP文档，作为H.225.0，但是后来当IETF发布了关于它的稳定的标准RFC后就被取消了。它作为因特网标准在RFC 3550（该文档的旧版本是RFC 1889）有详细说明。RFC 3551（STD 65，旧版本是RFC 1890）详细描述了使用最小控制的音频和视频会议。</p>
<p>RTP协议详细说明了在互联网上传递音频和视频的标准数据包格式。它一开始被设计为一个多播协议，但后来被用在很多单播应用中。RTP协议常用于流媒体系统（配合RTSP协议），视频会议和一键通（Push to Talk）系统（配合H.323或SIP），使它成为IP电话产业的技术基础。RTP协议和RTP控制协议RTCP一起使用，而且它是建立在UDP协议上的。<a href="https://zh.wikipedia.org/wiki/%E5%AE%9E%E6%97%B6%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener">实时传输协议——wiki</a></p>
<h2 id="2-JRTPLIB"><a href="#2-JRTPLIB" class="headerlink" title="2.JRTPLIB"></a>2.JRTPLIB</h2><p>RTP 是目前解决流媒体实时传输问题的最好办法，如果需要在Linux平台上进行实时流媒体编程，可以考虑使用一些开放源代码的RTP库，如LIBRTP、 JRTPLIB等。 JRTPLIB是一个面向对象的RTP库，它完全遵循RFC 1889设计，在很多场合下是一个非常不错的选择，下面就以JRTPLIB为例，讲述如何在Linux平台上运用RTP协议进行实时流媒体编程。</p>
<p>JRTPLIB 是一个用C++语言实现的RTP库，目前已经可以运行在Windows、Linux、FreeBSD、Solaris、Unix和 VxWorks等多种操作系统上。——<a href="http://www.oschina.net/p/jrtplib" target="_blank" rel="noopener">jrtp详细介绍</a></p>
<h2 id="3-JRTPLIB编译"><a href="#3-JRTPLIB编译" class="headerlink" title="3.JRTPLIB编译"></a>3.JRTPLIB编译</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/j0r1/JRTPLIB.git</span><br><span class="line">cd JRTPLIB</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake .. &amp;&amp; make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure>
<p>如果需要启用JThread支持，需要在编译JRTPLIB之前编译JThread</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/j0r1/JThread.git</span><br><span class="line">cd JRTPLIB</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake .. &amp;&amp; make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure>
<h2 id="4-JRTPLIB例程"><a href="#4-JRTPLIB例程" class="headerlink" title="4.JRTPLIB例程"></a>4.JRTPLIB例程</h2><p>官方历程参见<a href="https://github.com/j0r1/JRTPLIB/tree/master/examples" target="_blank" rel="noopener">https://github.com/j0r1/JRTPLIB/tree/master/examples</a>，以下是<code>example1.cpp</code>，添加了一些中文注释</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rtpsession.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rtpudpv4transmitter.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rtpipv4address.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rtpsessionparams.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rtperrors.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rtplibraryversion.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> jrtplib;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印错误信息</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">checkerror</span><span class="params">(<span class="keyword">int</span> rtperr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (rtperr &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ERROR: "</span> &lt;&lt; RTPGetErrorString(rtperr) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主循环</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// windows相关，不需要可以删了</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> RTP_SOCKETTYPE_WINSOCK</span></span><br><span class="line">    WSADATA dat;</span><br><span class="line">    WSAStartup(MAKEWORD(<span class="number">2</span>,<span class="number">2</span>),&amp;dat);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// RTP_SOCKETTYPE_WINSOCK</span></span></span><br><span class="line"></span><br><span class="line">    RTPSession sess;</span><br><span class="line">    <span class="keyword">uint16_t</span> portbase,destport;</span><br><span class="line">    <span class="keyword">uint32_t</span> destip;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> ipstr;</span><br><span class="line">    <span class="keyword">int</span> status,i,num;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印JRTPLIB版本</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Using version "</span> &lt;&lt; RTPLibraryVersion::GetVersion().GetVersionString() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取本地端口，用以接收</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Enter local portbase:"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; portbase;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 目标地址，本机使用127.0.0.1</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Enter the destination IP address"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; ipstr;</span><br><span class="line">    destip = inet_addr(ipstr.c_str());</span><br><span class="line">    <span class="keyword">if</span> (destip == INADDR_NONE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"Bad IP address specified"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// inet_addr函数返回的是网络字节序，需要将网络字节序转化为主机字节序</span></span><br><span class="line">    destip = ntohl(destip);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 目标端口，如果发送给本机，与上面的接收端口相同即可</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Enter the destination port"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; destport;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发包数量</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Number of packets you wish to be sent:"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; num;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建传输参数和会话参数</span></span><br><span class="line">    RTPUDPv4TransmissionParams transparams;</span><br><span class="line">    RTPSessionParams sessparams;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// IMPORTANT: The local timestamp unit MUST be set, otherwise</span></span><br><span class="line">    <span class="comment">//            RTCP Sender Report info will be calculated wrong</span></span><br><span class="line">    <span class="comment">// In this case, we'll be sending 10 samples each second, so we'll</span></span><br><span class="line">    <span class="comment">// put the timestamp unit to (1.0/10.0)</span></span><br><span class="line">    <span class="comment">// 设置时间戳</span></span><br><span class="line">    sessparams.SetOwnTimestampUnit(<span class="number">1.0</span>/<span class="number">10.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是否接收自己发送的包</span></span><br><span class="line">    sessparams.SetAcceptOwnPackets(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// 设置接收端口</span></span><br><span class="line">    transparams.SetPortbase(portbase);</span><br><span class="line">    <span class="comment">// 创建端口</span></span><br><span class="line">    status = sess.Create(sessparams,&amp;transparams);</span><br><span class="line">    checkerror(status);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写入IPv4地址和端口</span></span><br><span class="line">    <span class="function">RTPIPv4Address <span class="title">addr</span><span class="params">(destip,destport)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加目标地址</span></span><br><span class="line">    status = sess.AddDestination(addr);</span><br><span class="line">    checkerror(status);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= num ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nSending packet %d/%d\n"</span>,i,num);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发包</span></span><br><span class="line">        status = sess.SendPacket((<span class="keyword">void</span> *)<span class="string">"1234567890"</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="literal">false</span>,<span class="number">10</span>);</span><br><span class="line">        checkerror(status);</span><br><span class="line"></span><br><span class="line">        sess.BeginDataAccess();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查收包</span></span><br><span class="line">        <span class="keyword">if</span> (sess.GotoFirstSourceWithData())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">            &#123;</span><br><span class="line">                RTPPacket *pack;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> ((pack = sess.GetNextPacket()) != <span class="literal">NULL</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 在这里进行数据处理</span></span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">"Got packet !\n"</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 不再需要这个包了，删除之</span></span><br><span class="line">                    sess.DeletePacket(pack);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">while</span> (sess.GotoNextSourceWithData());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sess.EndDataAccess();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这部分与JThread库相关</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> RTP_SUPPORT_THREAD</span></span><br><span class="line">        status = sess.Poll();</span><br><span class="line">        checkerror(status);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// RTP_SUPPORT_THREAD</span></span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 等待一秒，发包间隔</span></span><br><span class="line">        RTPTime::Wait(RTPTime(<span class="number">1</span>,<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 销毁对话</span></span><br><span class="line">    sess.BYEDestroy(RTPTime(<span class="number">10</span>,<span class="number">0</span>),<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Windows相关</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> RTP_SOCKETTYPE_WINSOCK</span></span><br><span class="line">    WSACleanup();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// RTP_SOCKETTYPE_WINSOCK</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里会有问题，怎么读取收到的packet中的data，需要先包含头文件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rtppacket.h"</span></span></span><br></pre></td></tr></table></figure>
<p>在进行数据处理的地方使用以下函数获取负载数据，和负载长度</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pack-&gt;GetPayloadData();</span><br><span class="line">pack-&gt;GetPayloadLength();</span><br></pre></td></tr></table></figure>
<h2 id="5-CMake配置"><a href="#5-CMake配置" class="headerlink" title="5.CMake配置"></a>5.CMake配置</h2><p>在使用CMake进行编译的时候可能会出现找不到库的情况，需要手写<code>FindJRTPLIB.cmake</code></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - Find JRTPLIB library</span></span><br><span class="line"><span class="comment"># Once done this will define</span></span><br><span class="line"><span class="comment"># JRTPLIB_FOUND - system has JRTPLIB</span></span><br><span class="line"><span class="comment"># JRTPLIB_INCLUDE_DIR - JRTPLIB include directories</span></span><br><span class="line"><span class="comment"># JRTPLIB_LIBRARY - where to find the JRTPLIB library</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(JRTPLIB_INCLUDE_DIR)</span><br><span class="line">    <span class="comment"># Already in cache, be silent</span></span><br><span class="line">    <span class="keyword">set</span>(JRTPLIB_FIND_QUIETLY <span class="keyword">TRUE</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_path</span>(JRTPLIB_INCLUDE_DIR</span><br><span class="line">    NAMES rtpsession.h</span><br><span class="line">    PATH_SUFFIXES jrtplib jrtplib3</span><br><span class="line">    DOC <span class="string">"JRTPLIB include directories"</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_library</span>(JRTPLIB_LIBRARY</span><br><span class="line">    NAMES jrtp</span><br><span class="line">    DOC <span class="string">"JRTPLIB library"</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># handle the QUIETLY and REQUIRED arguments and set JRTPLIB_FOUND to TRUE if all listed variables are TRUE</span></span><br><span class="line"><span class="keyword">include</span>(FindPackageHandleStandardArgs)</span><br><span class="line">find_package_handle_standard_args(JRTPLIB</span><br><span class="line">                                  REQUIRED_VARS JRTPLIB_LIBRARY JRTPLIB_INCLUDE_DIR</span><br><span class="line">                                  VERSION_VAR JRTPLIB_VERSION_STRING)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(JRTPLIB_INCLUDE_DIR <span class="keyword">AND</span> JRTPLIB_LIBRARY)</span><br><span class="line">    <span class="keyword">set</span>(JRTPLIB_FOUND <span class="keyword">TRUE</span>)</span><br><span class="line">    <span class="keyword">set</span>(JRTPLIB_LIBRARIES <span class="variable">$&#123;JRTPLIB_LIBRARY&#125;</span>)</span><br><span class="line">    <span class="keyword">set</span>(JRTPLIB_INCLUDE_DIRS <span class="variable">$&#123;JRTPLIB_INCLUDE_DIR&#125;</span>)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">    <span class="keyword">set</span> (JRTPLIB_FOUND <span class="keyword">FALSE</span>)</span><br><span class="line">    <span class="keyword">message</span>(FATAL_ERROR <span class="string">"JRTPLIB not found"</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">mark_as_advanced</span>(</span><br><span class="line">    JRTPLIB_INCLUDE_DIR</span><br><span class="line">    JRTPLIB_LIBRARY)</span><br></pre></td></tr></table></figure>
<p>如果前面编译了JThread库，或者在编译的时候提示</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This function is not available when using the RTP Poll thread feature.</span><br></pre></td></tr></table></figure>
<p>则还需要将JThread库进行链接，<code>FindJTHREAD.cmake</code>如下</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - Find JTHREAD library</span></span><br><span class="line"><span class="comment"># Once done this will define</span></span><br><span class="line"><span class="comment"># JTHREAD_FOUND - system has JTHREAD</span></span><br><span class="line"><span class="comment"># JTHREAD_INCLUDE_DIR - JTHREAD include directories</span></span><br><span class="line"><span class="comment"># JTHREAD_LIBRARY - where to find the JTHREAD library</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(JTHREAD_INCLUDE_DIR)</span><br><span class="line">    <span class="comment"># Already in cache, be silent</span></span><br><span class="line">    <span class="keyword">set</span>(JTHREAD_FIND_QUIETLY <span class="keyword">TRUE</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_path</span>(JTHREAD_INCLUDE_DIR</span><br><span class="line">    NAMES jthread.h</span><br><span class="line">    PATH_SUFFIXES jthread jthread3</span><br><span class="line">    DOC <span class="string">"JTHREAD include directories"</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_library</span>(JTHREAD_LIBRARY</span><br><span class="line">    NAMES jthread</span><br><span class="line">    DOC <span class="string">"JTHREAD library"</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># handle the QUIETLY and REQUIRED arguments and set JTHREAD_FOUND to TRUE if all listed variables are TRUE</span></span><br><span class="line"><span class="keyword">include</span>(FindPackageHandleStandardArgs)</span><br><span class="line">find_package_handle_standard_args(JTHREAD</span><br><span class="line">                                  REQUIRED_VARS JTHREAD_LIBRARY JTHREAD_INCLUDE_DIR</span><br><span class="line">                                  VERSION_VAR JTHREAD_VERSION_STRING)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(JTHREAD_INCLUDE_DIR <span class="keyword">AND</span> JTHREAD_LIBRARY)</span><br><span class="line">    <span class="keyword">set</span>(JTHREAD_FOUND <span class="keyword">TRUE</span>)</span><br><span class="line">    <span class="keyword">set</span>(JTHREAD_LIBRARIES <span class="variable">$&#123;JTHREAD_LIBRARY&#125;</span>)</span><br><span class="line">    <span class="keyword">set</span>(JTHREAD_INCLUDE_DIRS <span class="variable">$&#123;JTHREAD_INCLUDE_DIR&#125;</span>)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">    <span class="keyword">set</span> (JTHREAD_FOUND <span class="keyword">FALSE</span>)</span><br><span class="line">    <span class="keyword">message</span>(FATAL_ERROR <span class="string">"JTHREAD not found"</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">mark_as_advanced</span>(</span><br><span class="line">    JTHREAD_INCLUDE_DIR</span><br><span class="line">    JTHREAD_LIBRARY)</span><br></pre></td></tr></table></figure>
<p>之后在顶层的<code>CMakeLists.txt</code>中使用<code>find_package(JRTPLIB)</code>进行链接，不再赘述。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pokerpoke.github.io/2018/03/08/9.JRTPLIB使用/" data-id="cjejklggl000ev2jxyn7o0l0l" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-8.CMake编译Qt项目" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/08/8.CMake编译Qt项目/" class="article-date">
  <time datetime="2018-03-09T06:38:41.272Z" itemprop="datePublished">2018-03-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="CMake编译Qt项目"><a href="#CMake编译Qt项目" class="headerlink" title="CMake编译Qt项目"></a>CMake编译Qt项目</h1><h2 id="1-背景"><a href="#1-背景" class="headerlink" title="1.背景"></a>1.背景</h2><p>对于Qt项目，一般情况下使用qmake进行编译，但是在编译过程中会对源代码有一定程度上的改变，而使用CMake则没有这种烦恼，或者说比较简单的进行编译。</p>
<p>借用网上的一句话：</p>
<blockquote>
<p>CMake is CMake, others are bullshit.</p>
</blockquote>
<h2 id="2-Qt"><a href="#2-Qt" class="headerlink" title="2.Qt"></a>2.Qt</h2><p>Qt（/ˈkjuːt/，發音同「cute」）是一个跨平台的C++應用程式開發框架。廣泛用於開發GUI程式，這種情況下又被称为部件工具箱。也可用於開發非GUI程式，比如控制台工具和伺服器。Qt使用於OPIE、Skype、VLC media player、Adobe Photoshop Elements、VirtualBox與Mathematica以及被Autodesk 、歐洲太空總署、夢工廠、Google、HP、KDE、盧卡斯影業、西門子公司、富豪集團, 華特迪士尼動畫製作公司、三星集團、飛利浦、Panasonic 所使用。<br>它是Digia公司的产品。Qt使用標準的C++和特殊的代码生成扩展（称为元对象编译器（Meta Object Compiler, moc））以及一些巨集。通過語言綁定，其他的程式語言也可以使用Qt。<br>Qt是自由且開放原始碼的軟體，在GNU較寬鬆公共許可證（LGPL）條款下發布。所有版本都支援廣泛的編譯器，包括GCC的C++編譯器和Visual Studio。——<a href="https://zh.wikipedia.org/wiki/Qt" target="_blank" rel="noopener">Qt-wiki</a></p>
<h2 id="3-准备工作"><a href="#3-准备工作" class="headerlink" title="3.准备工作"></a>3.准备工作</h2><p>Qt环境配置，在这里使用Qt4版本。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install qt4-default</span><br></pre></td></tr></table></figure>
<h2 id="4-CMakeLists-txt"><a href="#4-CMakeLists-txt" class="headerlink" title="4.CMakeLists.txt"></a>4.CMakeLists.txt</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找相关的依赖库</span></span><br><span class="line"><span class="keyword">find_package</span>(Qt4 REQUIRED)</span><br><span class="line"><span class="comment"># 添加路径</span></span><br><span class="line"><span class="keyword">include_directories</span>($(QT_INCLUDES))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置相关变量</span></span><br><span class="line"><span class="comment"># 自动添加当前目录至路径中</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_INCLUDE_CURRENT_DIR <span class="keyword">ON</span>)</span><br><span class="line"><span class="comment"># 自动运行moc</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_AUTOMOC <span class="keyword">ON</span>)</span><br><span class="line"><span class="comment"># 自动运行uic</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_AUTOUIC <span class="keyword">ON</span>)</span><br><span class="line"><span class="comment"># 自动运行rcc</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_AUTORCC <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成可执行文件</span></span><br><span class="line"><span class="keyword">add_executable</span>(main main.cc)</span><br><span class="line"><span class="comment"># 链接库</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(main Qt4::QtCore Qt4::QtGui)</span><br></pre></td></tr></table></figure>
<p>至此已经可以编译单文件的Qt项目了。</p>
<h2 id="5-使用Qt-Designer进行界面设计"><a href="#5-使用Qt-Designer进行界面设计" class="headerlink" title="5.使用Qt Designer进行界面设计"></a>5.使用Qt Designer进行界面设计</h2><p>编译项目的时候会使用Qt Designer进行界面设计，完了会生成一个ui文件，我们需要将这个文件进行转换成相应的头件，当<code>CMAKE_AUTOUIC</code>设为<code>ON</code>的时候会自动生成相应的<code>ui_xxxxx.h</code>文件，只需要在相应的c++文件中<code>#include ui_xxxxx.h</code>即可。</p>
<p>如果没有开启该选项则可以在<code>CMakeLists.txt</code>使用以下命令进行手动生成。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qt4_wrap_ui(OUTPUT_FILED INPUT_FILES)</span><br></pre></td></tr></table></figure>
<h2 id="6-多个文件的情况"><a href="#6-多个文件的情况" class="headerlink" title="6.多个文件的情况"></a>6.多个文件的情况</h2><p>正常情况下我们会将不同界面写在不同文件里，假设我们的项目目录结构如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">├── CMakeLists.txt</span><br><span class="line">├── test.cc</span><br><span class="line">├── test.h</span><br><span class="line">├── test.ui             # ui文件</span><br><span class="line">├── main.cc             # 主函数所在文件</span><br></pre></td></tr></table></figure>
<p>按照上面的步骤会出现如下错误或者一些函数为声明的错误</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">collect2: error: ld return 1 exit status</span><br></pre></td></tr></table></figure>
<p>出现原因是因为没有将相关的文件生成动态库，自然找不到库文件或者函数声明了，解决方法是在<code>CMakeLists.txt</code>中添加如下命令：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成动态库</span></span><br><span class="line"><span class="keyword">add_library</span>(test_lib SHARED test.cc test.h)</span><br><span class="line"><span class="comment"># 链接相关依赖</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(test_lib Qt4::QtCore Qt4::QtGui)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成可执行文件</span></span><br><span class="line"><span class="keyword">add_executable</span>(main main.cc)</span><br><span class="line"><span class="comment"># 链接库</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(main test_lib Qt4::QtCore Qt4::QtGui)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pokerpoke.github.io/2018/03/08/8.CMake编译Qt项目/" data-id="cjejklggk000dv2jxjmf6zy7o" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">weiter &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/03/08/1.nginx将.js .css处理为text plain/">(no title)</a>
          </li>
        
          <li>
            <a href="/2018/03/08/15.samba配置文件共享服务/">(no title)</a>
          </li>
        
          <li>
            <a href="/2018/03/08/16.deluge+ss实现服务器ipv6环境下bt下载/">(no title)</a>
          </li>
        
          <li>
            <a href="/2018/03/08/14.树莓派连接无线网络/">(no title)</a>
          </li>
        
          <li>
            <a href="/2018/03/08/13.树莓派烧录系统镜像/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Jiang Yang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>